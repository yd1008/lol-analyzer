{% extends "base.html" %}

{% block title %}{{ lt('Settings - LoL Analyzer', '设置 - LoL 分析器') }}{% endblock %}

{% block content %}
<div class="container dashboard">
    <div class="dashboard-header">
        <div class="page-title-block">
            <div class="page-eyebrow">{{ lt('Setup', '配置') }}</div>
            <h1>{{ lt('Settings', '设置') }}</h1>
        </div>
    </div>

    <div class="card setup-checklist">
        <h3>{{ lt('Complete Setup Checklist', '完成配置清单') }}</h3>
        <div class="setup-check-grid">
            <div class="setup-check-item {{ 'done' if riot_account and riot_account.is_verified else 'pending' }}">
                <span>{{ lt('Done', '完成') if riot_account and riot_account.is_verified else '1' }}</span>
                <div>
                    <strong>{{ lt('Link Riot Account', '绑定 Riot 账号') }}</strong>
                    <p>{{ lt('Required for match sync and analysis.', '用于同步和分析对局（必需）。') }}</p>
                </div>
            </div>
            <div class="setup-check-item {{ 'done' if discord_config and discord_config.channel_id else 'pending' }}">
                <span>{{ lt('Done', '完成') if discord_config and discord_config.channel_id else '2' }}</span>
                <div>
                    <strong>{{ lt('Set Discord Channel', '设置 Discord 频道') }}</strong>
                    <p>{{ lt('Optional but recommended for instant reports.', '可选，但建议开启以获得即时报告。') }}</p>
                </div>
            </div>
            <div class="setup-check-item {{ 'done' if current_user.settings else 'pending' }}">
                <span>{{ lt('Done', '完成') if current_user.settings else '3' }}</span>
                <div>
                    <strong>{{ lt('Tune Preferences', '调整偏好') }}</strong>
                    <p>{{ lt('Choose cadence and summary schedule.', '选择检查频率和周报计划。') }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Riot Account -->
    <div class="card settings-section">
        <h3>{{ lt('Riot Account', 'Riot 账号') }}</h3>
        {% if riot_account and riot_account.is_verified %}
        <div class="settings-status verified">{{ lt('Verified', '已验证') }}: {{ riot_account.summoner_name }}#{{ riot_account.tagline }} ({{ riot_account.region.upper() }})</div>
        {% endif %}
        <form method="POST" action="{{ url_for('dashboard.settings_riot') }}">
            {{ riot_form.hidden_tag() }}
            <div class="form-group">
                <label for="{{ riot_form.summoner_name.id }}">{{ t(riot_form.summoner_name.label.text) }}</label>
                {{ riot_form.summoner_name(placeholder=lt("e.g. Faker", "例如：Faker")) }}
                <div class="hint">{{ lt('Your in-game summoner name (case-insensitive).', '你的游戏内召唤师名称（不区分大小写）。') }}</div>
                {% for error in riot_form.summoner_name.errors %}
                    <div class="error">{{ t(error) }}</div>
                {% endfor %}
            </div>
            <div class="form-group">
                <label for="{{ riot_form.tagline.id }}">{{ t(riot_form.tagline.label.text) }}</label>
                {{ riot_form.tagline(placeholder=lt("e.g. KR1", "例如：KR1")) }}
                <div class="hint">{{ lt('The tag after the # in your Riot ID. Do not include the # symbol.', 'Riot ID 中 # 后面的标签。请不要输入 #。') }}</div>
                {% for error in riot_form.tagline.errors %}
                    <div class="error">{{ t(error) }}</div>
                {% endfor %}
            </div>
            <div class="form-group">
                <label for="{{ riot_form.region.id }}">{{ t(riot_form.region.label.text) }}</label>
                {{ riot_form.region() }}
                <div class="hint">{{ lt('Select the server region where your account is registered.', '选择你账号所在的大区。') }}</div>
                {% for error in riot_form.region.errors %}
                    <div class="error">{{ t(error) }}</div>
                {% endfor %}
            </div>
            <button type="submit" class="btn btn-primary btn-sm">{{ lt('Link Account', '绑定账号') }}</button>
        </form>
    </div>

    <!-- Discord -->
    <div class="card settings-section">
        <h3>{{ lt('Discord Notifications', 'Discord 通知') }}</h3>
        {% if bot_invite_url %}
        <div class="discord-step-row">
            <p><strong>{{ lt('Step 1:', '第 1 步：') }}</strong> {{ lt('Add bot to your server.', '将机器人添加到你的服务器。') }}</p>
            <a href="{{ bot_invite_url }}" target="_blank" class="btn btn-secondary btn-sm">{{ lt('Add Bot', '添加机器人') }}</a>
        </div>
        {% endif %}
        <p class="discord-step-note">
            <strong>{{ lt('Step 2:', '第 2 步：') }}</strong> {{ lt('Enable Developer Mode in Discord (Settings > Advanced), right-click the target channel, and copy the Channel ID.', '在 Discord 启用开发者模式（设置 > 高级），右键目标频道并复制频道 ID。') }}
        </p>
        {% if discord_config %}
        <div class="settings-status active">{{ lt('Channel', '频道') }}: {{ discord_config.channel_id }}</div>
        {% endif %}
        <form method="POST" action="{{ url_for('dashboard.settings_discord') }}">
            {{ discord_form.hidden_tag() }}
            <div class="form-group">
                <label for="{{ discord_form.channel_id.id }}">{{ t(discord_form.channel_id.label.text) }}</label>
                {{ discord_form.channel_id(placeholder=lt("e.g. 1234567890123456789", "例如：1234567890123456789")) }}
                <div class="hint">{{ lt('Must be a numeric ID (17-20 digits). Right-click the channel in Discord to copy it.', '必须为数字 ID（17-20 位）。可右键 Discord 频道复制。') }}</div>
                {% for error in discord_form.channel_id.errors %}
                    <div class="error">{{ t(error) }}</div>
                {% endfor %}
            </div>
            <div class="form-group">
                <label for="{{ discord_form.guild_id.id }}">{{ t(discord_form.guild_id.label.text) }}</label>
                {{ discord_form.guild_id(placeholder=lt("e.g. 1234567890123456789", "例如：1234567890123456789")) }}
                <div class="hint">{{ lt('Optional. Right-click your server name to copy the Server ID.', '可选。右键服务器名称可复制服务器 ID。') }}</div>
                {% for error in discord_form.guild_id.errors %}
                    <div class="error">{{ t(error) }}</div>
                {% endfor %}
            </div>
            <button type="submit" class="btn btn-primary btn-sm">{{ lt('Save Discord Config', '保存 Discord 配置') }}</button>
        </form>
    </div>

    <!-- Preferences -->
    <div class="card settings-section">
        <h3>{{ lt('Preferences', '偏好设置') }}</h3>
        <form method="POST" action="{{ url_for('dashboard.settings_preferences') }}">
            {{ prefs_form.hidden_tag() }}
            <div class="form-group">
                <label for="{{ prefs_form.check_interval.id }}">{{ t(prefs_form.check_interval.label.text) }}</label>
                {{ prefs_form.check_interval() }}
            </div>
            <div class="form-group">
                <label for="{{ prefs_form.weekly_summary_day.id }}">{{ t(prefs_form.weekly_summary_day.label.text) }}</label>
                {{ prefs_form.weekly_summary_day() }}
            </div>
            <div class="form-group">
                <label for="{{ prefs_form.weekly_summary_time.id }}">{{ t(prefs_form.weekly_summary_time.label.text) }}</label>
                {{ prefs_form.weekly_summary_time() }}
            </div>
            <div class="form-group form-check">
                {{ prefs_form.notifications_enabled() }}
                <label for="{{ prefs_form.notifications_enabled.id }}">{{ t(prefs_form.notifications_enabled.label.text) }}</label>
            </div>
            <button type="submit" class="btn btn-primary btn-sm">{{ lt('Save Preferences', '保存偏好') }}</button>
        </form>
    </div>
</div>
{% endblock %}
