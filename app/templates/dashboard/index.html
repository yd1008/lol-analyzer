{% extends "base.html" %}

{% block title %}{{ lt('Dashboard - LoL Analyzer', '仪表盘 - LoL 分析器') }}{% endblock %}

{% block content %}
<div class="container dashboard">
    <div class="dashboard-header">
        <div class="page-title-block">
            <div class="page-eyebrow">{{ lt('Overview', '概览') }}</div>
            <h1>{{ lt('Dashboard', '仪表盘') }}</h1>
        </div>
        {% if riot_account %}
            <span class="dashboard-id">{{ riot_account.summoner_name }}#{{ riot_account.tagline }}</span>
        {% endif %}
    </div>

    <div class="hud-artboard" aria-hidden="true">
        <div class="hud-art-grid"></div>
        <div class="hud-art-orb"></div>
        <div class="hud-art-scan"></div>
    </div>

    <div class="card quick-guide">
        <h3>{{ lt('Use This Dashboard in 3 Steps', '3 步用好这个仪表盘') }}</h3>
        <div class="quick-guide-grid">
            <div class="quick-guide-step"><span>1</span>{{ lt('Run or regenerate AI analysis on recent matches.', '对最近对局运行或重生成 AI 分析。') }}</div>
            <div class="quick-guide-step"><span>2</span>{{ lt('Compare your metrics to team and lobby averages.', '将你的数据与队伍均值和全局均值对比。') }}</div>
            <div class="quick-guide-step"><span>3</span>{{ lt('Pick one improvement focus and apply it next game.', '选定一个改进重点并在下一局执行。') }}</div>
        </div>
    </div>

    {% if not riot_account %}
    <div class="setup-prompt">
        <div>
            <strong>{{ lt('Link your Riot account to get started', '先绑定 Riot 账号开始使用') }}</strong>
            <p>{{ lt('Connect your summoner name so we can start analyzing your matches.', '绑定你的召唤师信息后即可开始分析对局。') }}</p>
        </div>
        <a href="{{ url_for('dashboard.settings') }}" class="btn btn-primary btn-sm">{{ lt('Go to Settings', '前往设置') }}</a>
    </div>
    {% endif %}

    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-label">{{ lt('Total Games', '总对局') }}</div>
            <div class="stat-value">{{ total_games }}</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">{{ lt('Win Rate', '胜率') }}</div>
            <div class="stat-value">{{ win_rate }}%</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">{{ lt('Wins', '胜场') }}</div>
            <div class="stat-value">{{ wins }}</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">{{ lt('Avg KDA', '平均 KDA') }}</div>
            <div class="stat-value">{{ avg_kda }}</div>
        </div>
    </div>

    <div class="card coach-mode-card">
        <div class="section-head">
            <div>
                <div class="section-label">{{ lt('Personalization', '个性化') }}</div>
                <h3>{{ lt('AI Coach Mode', 'AI 教练模式') }}</h3>
            </div>
        </div>
        <p class="card-muted">{{ lt('Choose how strict or supportive your coaching tone should be. This mode applies to all AI analyses.', '选择建议风格偏激进、均衡或鼓励。此模式会应用到所有 AI 分析。') }}</p>
        <div class="coach-mode-controls">
            <label for="coach-mode-select">{{ lt('Coach style', '教练风格') }}</label>
            <select id="coach-mode-select" class="input">
                <option value="balanced">{{ lt('Balanced', '均衡') }}</option>
                <option value="aggressive">{{ lt('Aggressive', '激进') }}</option>
                <option value="supportive">{{ lt('Supportive', '鼓励') }}</option>
            </select>
        </div>
    </div>

    <div class="card coach-plan-card">
        <div class="section-head">
            <div>
                <div class="section-label">{{ lt('Differentiator', '核心差异化') }}</div>
                <h3>{{ lt('AI Coach Focus Plan', 'AI 教练焦点计划') }}</h3>
            </div>
            <div class="coach-score-badge">
                <span>{{ lt('Coach Score', '教练评分') }}</span>
                <strong>{{ coach_plan.coach_score }}</strong>
            </div>
        </div>
        <div class="coach-plan-grid">
            <div>
                <h4>{{ lt('Current Strengths', '当前优势') }}</h4>
                <ul>
                    {% for item in coach_plan.strengths %}
                    <li>{{ item }}</li>
                    {% endfor %}
                </ul>
            </div>
            <div>
                <h4>{{ lt('Priority Improvements', '优先提升项') }}</h4>
                <ul>
                    {% for item in coach_plan.focus_areas %}
                    <li>{{ item }}</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
        <div class="coach-next-goal">
            <strong>{{ lt('Actionable next-game goal:', '下局可执行目标：') }}</strong>
            <span>{{ coach_plan.next_game_goal }}</span>
        </div>
    </div>

    <div class="card trend-snapshot-card">
        <div class="section-head">
            <div>
                <div class="section-label">{{ lt('Progress Tracking', '进展追踪') }}</div>
                <h3>{{ lt('Performance Trend Snapshot', '表现趋势快照') }}</h3>
            </div>
        </div>
        <p class="trend-headline">{{ trend_snapshot.headline }}</p>
        <ul class="trend-signal-list">
            {% for signal in trend_snapshot.signals %}
            <li>{{ signal }}</li>
            {% endfor %}
        </ul>
    </div>

    <div class="card matches-card">
        <div class="section-head">
            <div>
                <div class="section-label">{{ lt('Match Queue', '对局列表') }}</div>
                <h3>{{ lt('Recent Matches', '最近对局') }}</h3>
            </div>
            <p class="card-muted">{{ lt('Stream AI coaching inline without leaving the dashboard.', '无需离开仪表盘即可实时查看 AI 建议。') }}</p>
        </div>

        <div class="match-filter-bar" id="match-filter-bar" role="tablist" aria-label="{{ lt('Filter matches by queue', '按队列筛选对局') }}">
            <button type="button" class="filter-btn active" id="queue-filter-all" data-queue="" role="tab" aria-selected="true" aria-controls="match-list" tabindex="0">{{ lt('All', '全部') }}</button>
            <button type="button" class="filter-btn" id="queue-filter-ranked-solo" data-queue="Ranked Solo" role="tab" aria-selected="false" aria-controls="match-list" tabindex="-1">{{ queue_label('Ranked Solo') }}</button>
            <button type="button" class="filter-btn" id="queue-filter-ranked-flex" data-queue="Ranked Flex" role="tab" aria-selected="false" aria-controls="match-list" tabindex="-1">{{ queue_label('Ranked Flex') }}</button>
            <button type="button" class="filter-btn" id="queue-filter-normal" data-queue="Normal Draft,Normal Blind" role="tab" aria-selected="false" aria-controls="match-list" tabindex="-1">{{ lt('Normal', '匹配') }}</button>
        </div>

        <div id="match-list">
        </div>

        {% if total_games > 10 %}
        <div class="load-more-container" id="load-more-container">
            <button class="btn btn-secondary btn-sm" id="load-more-btn">{{ lt('Load More', '加载更多') }}</button>
        </div>
        {% endif %}
    </div>
</div>

<script>
    window.__initialMatches = {{ initial_matches_json | tojson }};
    window.__initialMatchCount = {{ analyses|length }};
    window.__totalGames = {{ total_games }};
</script>
{% endblock %}
